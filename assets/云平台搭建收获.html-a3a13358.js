import{_ as n,p as s,q as a,a1 as t}from"./framework-5866ffd3.js";const p={},e=t(`<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p>本篇笔记主要记录使用vue2+js搭建工作的第一个项目的收获。项目使用vue-cli搭建。</p><p>技术栈：vue2，JavaScript，vue-router，vuex，axios，element-UI等</p><h2 id="swiper库动态渲染问题" tabindex="-1"><a class="header-anchor" href="#swiper库动态渲染问题" aria-hidden="true">#</a> swiper库动态渲染问题</h2><p>**问题：**在发送请求获取轮播图图片需要时间，由于初始时轮播图数组是空的，所以模板上的dom结构还没有使用v-for遍历展现出来，而js部分创建swiper实例是需要完整dom结构，所以最终没有效果；</p><p>我们可能会想到在watch中侦听轮播图数组，有数据时再创建swiper实例，但由于数据变化时会先执行watch的处理函数即创建swiper实例，再更新模板dom，，所以还是不行，这时候我们就会想<strong>vue有没有一种方法在数据变化时先更新模板，再执行数据变化对应的回调</strong>。</p><p><strong>this.$nextTick() / Vue.nextTick()</strong> : 接收一个回调函数，在下次 DOM 更新循环结束之后执行延迟回调。在修改数据之后立即使用这个方法，获取更新后的 DOM。</p><p>最终配合watch侦听和nextTick就可以实现完美效果：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 侦听bannerList，当有数据的时候先使用this.$nextTick让页面v-for循环完再创建swiper示例</span>
    <span class="token function">bannerList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Swiper</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>swiper<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loop</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 循环模式选项</span>

          <span class="token comment">// 如果需要分页器</span>
          <span class="token literal-property property">pagination</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">&quot;.swiper-pagination&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>

          <span class="token comment">// 如果需要前进后退按钮</span>
          <span class="token literal-property property">navigation</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">nextEl</span><span class="token operator">:</span> <span class="token string">&quot;.swiper-button-next&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">prevEl</span><span class="token operator">:</span> <span class="token string">&quot;.swiper-button-prev&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">//自动轮播</span>
          <span class="token literal-property property">autoplay</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">2500</span><span class="token punctuation">,</span> <span class="token comment">//时间 毫秒</span>
            <span class="token literal-property property">stopOnLastSlide</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否切换到最后一个slide时停止自动切换</span>
            <span class="token literal-property property">disableOnInteraction</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//操作swiper之后，是否禁止autoplay</span>
            <span class="token literal-property property">pauseOnMouseEnter</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//鼠标置于swiper时暂停自动切换</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现下载文件以及打包成压缩包" tabindex="-1"><a class="header-anchor" href="#实现下载文件以及打包成压缩包" aria-hidden="true">#</a> 实现下载文件以及打包成压缩包</h2><p>总结一下前端实现文件下载的方式</p><p>第一种：使用 a 标签下载，当给a标签添加download属性时就可以下载对应文件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 创建a标签</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 定义下载名称(跨域修改会失效)</span>
a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">&#39;input.txt&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 隐藏标签</span>
a<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 设置文件路径</span>
a<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 将创建的标签插入dom</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 点击标签，执行下载</span>
a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将标签从dom移除</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二种：使用window.open( url ) 方式下载，但实测会有闪动，不推荐。</p><p>第三种：使用 FileSaver库 实现，第一个参数表示它支持 Blob/File/Url 三种类型，第二个参数表示文件名（可选），而第三个参数表示配置对象（可选）。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>FileSaver <span class="token function">saveAs</span><span class="token punctuation">(</span>Blob<span class="token operator">/</span>File<span class="token operator">/</span>Url<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> optional Object <span class="token punctuation">{</span> autoBom <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>有时候当我们需要下载多个文件并打包形成压缩包时，就可以使用 jszip 和 FileSaver 搭配实现。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 引入实现下载压缩包的两个库</span>
<span class="token keyword">import</span> JSZip <span class="token keyword">from</span> <span class="token string">&#39;jszip&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> FileSaver <span class="token keyword">from</span> <span class="token string">&#39;file-saver&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 引入请求模块</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span>


<span class="token comment">// 实现下载压缩包按钮的方法</span>
<span class="token function">downloadZip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> zip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSZip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//用于存储多个promise</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fileArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 实现下载单个文件</span>
      <span class="token function">axios</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> item<span class="token punctuation">.</span>fileUrl<span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">&#39;blob&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token comment">//request请求的状态</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            
      <span class="token comment">// 单个文件下载成功，拿到内容命名后转为二进制存储</span>
      <span class="token keyword">let</span> fileName <span class="token operator">=</span> item<span class="token punctuation">.</span>fileName<span class="token punctuation">;</span>
      <span class="token comment">// 在此处可以设置压缩包文件夹  zip.file(文件夹名/文件名, 文件内容 ,{配置项});</span>
      zip<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> res<span class="token punctuation">.</span>data <span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">binary</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 将单个promise存到数组中，后续使用promise.all判断整体状态</span>
    promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将压缩包里的文件压缩，返回一个promise实例，成功结果res返回的就是压缩包</span>
    zip<span class="token punctuation">.</span><span class="token function">generateAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;blob&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">compression</span><span class="token operator">:</span> <span class="token string">&quot;DEFLATE&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// STORE：默认不压缩 DEFLATE：需要压缩</span>
      <span class="token literal-property property">compressionOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token number">9</span>               <span class="token comment">// 压缩等级1~9    1压缩速度最快，9最优压缩方式</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      FileSaver<span class="token punctuation">.</span><span class="token function">saveAs</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;结果压缩包.zip&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 利用file-saver保存文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="登录页实现登陆后跳回" tabindex="-1"><a class="header-anchor" href="#登录页实现登陆后跳回" aria-hidden="true">#</a> 登录页实现登陆后跳回</h2><p>**前言：**有时候我们希望当我们在某一页面跳转到登录页登录后还能立即跳转回对应页面，我们只需要在跳转到登录页时添加一个query参数，里面放上跳转前的路径，例如 <em><strong>:to=&quot;{ path:&#39;/login&#39;, query:{redirct:route.fullPath} }&quot;</strong></em>。</p><p>获取到来时页面的路由就可以在登录按钮函数里的相关逻辑完成后跳转回对应页面了，登录界面其他按钮的跳转正常使用即可。</p><p><strong>有关next函数</strong>：其实在路由守卫中，只有next()是放行，其他含有参数的诸如：next(&#39;/logon&#39;) 、 next(to) 或者 next({ ...to, replace: true })都不是放行，而是：中断当前路由守卫导航，执行重载后的路由守卫。</p><p>例如：下面代码并不是直接跳转到login路由，而是对路由守卫重载，将原本的to.path替换为了/login再次执行。这样就会导致路由死循环，堆溢出情况。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token comment">// 本质上：</span>
<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&#39;/logon&#39;</span><span class="token punctuation">,</span> from<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&#39;/logon&#39;</span><span class="token punctuation">,</span> from<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&#39;/logon&#39;</span><span class="token punctuation">,</span> from<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                beforeEac<span class="token operator">...</span>  <span class="token comment">// 一直循环下去...... , 因为我们没有使用 next() 放行</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>所以一定要在路由守卫里面添加对应的条件判断，对符合条件的路由直接调用next()放行。</p></blockquote><h2 id="重置组件的data数据" tabindex="-1"><a class="header-anchor" href="#重置组件的data数据" aria-hidden="true">#</a> 重置组件的data数据</h2><p><strong>Object.assign() 方法</strong>用于将所有可枚举属性的值从一个或多个源对象复制到目标对象。它将返回目标对象。 用法： Object.assign(target, ...sources) 第一个参数是目标对象，第二个参数是源对象，就是将源对象属性复制到目标对象，返回目标对象。</p><p>在vue2中： this.$data 获取当前状态下的data。 this.$options.data() 获取该组件初始状态下的data</p><p>所以，下面就可以将初始状态的data复制到当前状态的data，实现重置效果： <strong>Object.assign(this.$data, this.$options.data())</strong></p><p>当然，如果你只想重置data中的某一个对象或者属性： this.form = this.$options.data().form</p><h2 id="上传图片并实现图片预览" tabindex="-1"><a class="header-anchor" href="#上传图片并实现图片预览" aria-hidden="true">#</a> 上传图片并实现图片预览</h2><p>前言：前端经常会遇到上传图片的功能，下面我们就来看看如何上传一张图片到后台。</p><p>首先当然是需要一个输入框选择图片文件,一个img标签展示预览图片</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image/jpg,image/png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>previewAvatar<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userAvatar<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>avatar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>当我们选择完图片后，我们是希望将这张图片展示出来的，我们可以通过URL.createObjectURL 或是 FileReader 预览实现预览。下面就介绍使用 URL.createObjectURL 实现</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 实现预览功能</span>
<span class="token function">fileChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>previewAvatar<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>raw<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>之后就可以提交了（此处是el-upload的上传方法）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>el<span class="token operator">-</span>upload
  <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;avatar-uploader&quot;</span>
  action<span class="token operator">=</span><span class="token string">&quot;#&quot;</span>
  <span class="token operator">:</span>headers<span class="token operator">=</span><span class="token string">&quot;{&#39;Content-Type&#39;: &#39;multipart/form-data&#39;}&quot;</span>
  <span class="token operator">:</span>auto<span class="token operator">-</span>upload<span class="token operator">=</span><span class="token string">&quot;false&quot;</span>
  <span class="token operator">:</span>multiple<span class="token operator">=</span><span class="token string">&quot;false&quot;</span>
  <span class="token operator">:</span>show<span class="token operator">-</span>file<span class="token operator">-</span>list<span class="token operator">=</span><span class="token string">&quot;false&quot;</span>
  <span class="token operator">:</span>on<span class="token operator">-</span>change<span class="token operator">=</span><span class="token string">&quot;handleChange&quot;</span>
  <span class="token operator">:</span>before<span class="token operator">-</span>upload<span class="token operator">=</span><span class="token string">&quot;beforeAvatarUpload&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>img ref<span class="token operator">=</span><span class="token string">&quot;previewAvatar&quot;</span> <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;userAvatar&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;avatar&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>upload<span class="token operator">&gt;</span>
        
<span class="token comment">// 提交文件</span>
<span class="token function">submitAvatar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  param<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;avatarfile&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>raw<span class="token punctuation">)</span>

  <span class="token function">reqUploadAvatar</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此外还有使用 FileReader 实现转化为base64格式，再实现预览和上传的（这样上传就不用创建formData）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>file<span class="token punctuation">.</span><span class="token function-variable function">onchange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//获取到一个FileList对象中的第一个文件( File 对象),是我们上传的文件</span>
    <span class="token keyword">var</span> fileData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//异步读取文件内容，结果用data:url的字符串形式表示</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>fileData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*当读取操作成功完成时调用*/</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//要的数据 这里的this指向FileReader（）对象的实例reader</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>previewAvatar<span class="token punctuation">.</span>src<span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="随记-简单生成任务编号" tabindex="-1"><a class="header-anchor" href="#随记-简单生成任务编号" aria-hidden="true">#</a> 随记--简单生成任务编号</h2><p>记录一下获取到当前年月日时分秒 + 6位随机数以此产生任务编号的方式</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 生成任务编号的方法</span>
<span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 生成任务编号</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> year <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> month <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token operator">?</span> time<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token string">&#39;0&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span> time<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token keyword">let</span> date <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token operator">?</span>  time<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;0&#39;</span> <span class="token operator">+</span>  time<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> hours <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token operator">?</span>  time<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;0&#39;</span> <span class="token operator">+</span>  time<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> minutes <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token operator">?</span>  time<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;0&#39;</span> <span class="token operator">+</span>  time<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> seconds <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token operator">?</span>  time<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;0&#39;</span> <span class="token operator">+</span>  time<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 获取到年月日时分秒</span>
  <span class="token keyword">let</span> currentTime <span class="token operator">=</span> year<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> month <span class="token operator">+</span> date <span class="token operator">+</span> hours <span class="token operator">+</span> minutes <span class="token operator">+</span> seconds
  <span class="token comment">// 再产生6位随机数拼接赋值给任务id</span>
  <span class="token keyword">let</span> randomNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dataInput<span class="token punctuation">.</span>taskId <span class="token operator">=</span> currentTime <span class="token operator">+</span> randomNum
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="keep-alive与跳转动画" tabindex="-1"><a class="header-anchor" href="#keep-alive与跳转动画" aria-hidden="true">#</a> keep-alive与跳转动画</h2><p><strong>keep-alive</strong></p><p>在页面进行路由跳转时使用过度动画提高用户感受，并且也可以用缓存组件的方式优化加载静态资源的性能，不必每次打开时都发送请求获取对应固定数据。注意此时include的参数是需要缓存的组件的名称。</p><p>keep-alive实现路由缓存，在include里的相关命名的组件都会被缓存，只要在此同级路由（父级路由不变）里切换时不会被销毁。</p><p><strong>路由的key属性</strong></p><p>而路由的key属性是让当参数相同时就不会强制刷新而是复用此路由页面，默认是会复用的。</p><p>由于 Vue 会复用相同组件, 即 /page/1 =&gt; /page/2 或者 /page?id=1 =&gt; /page?id=2 这类链接跳转时, 将不再执行created, mounted之类的钩子, 这时候你需要在路由组件中, 添加beforeRouteUpdate钩子来执行相关方法拉去数据；</p><p>但设置了<code>:key=$route.fullPath</code>后，由于两次的key /page/1和/page/2 并不一样, 所以组件被强制不复用, 相关钩子加载顺序为:beforeRouteUpdate =&gt; created =&gt; mounted</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fade-transform<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>out-in<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>platformHome,allSoftware<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$route.fullPath<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token comment">/* fade-transform */</span>
<span class="token selector">.fade-transform-leave-active,
.fade-transform-enter-active</span> <span class="token punctuation">{</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> all .5s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.fade-transform-enter</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-30px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.fade-transform-leave-to</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>30px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然也可以在路由的meta标签里配置相关属性通过if判断是否需要强制刷新。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
  	<span class="token operator">&lt;</span>keep<span class="token operator">-</span>alive<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>router<span class="token operator">-</span>view v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;$route.meta.keepAlive&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>keep<span class="token operator">-</span>alive<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>router<span class="token operator">-</span>view v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;!$route.meta.keepAlive&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="解决textarea无法输入tab键问题" tabindex="-1"><a class="header-anchor" href="#解决textarea无法输入tab键问题" aria-hidden="true">#</a> 解决textarea无法输入tab键问题</h2><p>只需给文本域绑定一个keydown键盘按下事件，事件回调如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">handleTextareaTab</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 检测到输入tab键，就阻止事件默认行为</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>keyCode <span class="token operator">!==</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
	event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	
  <span class="token comment">// 转义字符代替制表符，获取当前输入焦点</span>
	<span class="token keyword">const</span> insertText <span class="token operator">=</span> <span class="token string">&#39;\\t&#39;</span>
	<span class="token keyword">const</span> textarea <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>textarea
	<span class="token keyword">const</span> startPos <span class="token operator">=</span> textarea<span class="token punctuation">.</span>selectionStart <span class="token comment">// 获取选中开始位置</span>
	<span class="token keyword">const</span> endPos <span class="token operator">=</span> textarea<span class="token punctuation">.</span>selectionEnd <span class="token comment">// 获取选中结束位置</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>startPos <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> endPos <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
	<span class="token keyword">const</span> txt <span class="token operator">=</span> textarea<span class="token punctuation">.</span>value
	
  <span class="token comment">// 截取焦点前内容，拼接tab制表符转义字符和焦点后内容，再获取焦点	</span>
	textarea<span class="token punctuation">.</span>value <span class="token operator">=</span> txt<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> startPos<span class="token punctuation">)</span> <span class="token operator">+</span> insertText <span class="token operator">+</span> txt<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>endPos<span class="token punctuation">)</span>
	textarea<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	textarea<span class="token punctuation">.</span>selectionStart <span class="token operator">=</span> startPos <span class="token operator">+</span> insertText<span class="token punctuation">.</span>length
	textarea<span class="token punctuation">.</span>selectionEnd <span class="token operator">=</span> startPos <span class="token operator">+</span> insertText<span class="token punctuation">.</span>length
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,58),o=[e];function c(l,i){return s(),a("div",null,o)}const r=n(p,[["render",c],["__file","云平台搭建收获.html.vue"]]);export{r as default};
